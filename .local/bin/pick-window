#!/usr/bin/env bash

DMENU="wofi -dmenu --show-icons -i -p Windows"
SEP=$'\x1f'    # ASCII unit separator, unlikely to collide with titles

mapfile -t entries < <(
  hyprctl clients -j \
    | jq -r --arg SEP "$SEP" '
      .[] |
      "\(.title) (WS \(.workspace.id) on \(.monitor))" +
      "\($SEP)\(.workspace.id)" +
      "\($SEP)\(.monitor)" +
      "\($SEP)\(.address)"
    '
)

selected=$(printf '%s\n' "${entries[@]}" | $DMENU)
[ -z "$selected" ] && exit

IFS="$SEP" read -r label ws mon address <<<"$selected"

hyprctl dispatch workspace "$ws" "monitor:$mon"

sleep 0.05

hyprctl dispatch focuswindow address:"$address"
