# TMUX Plugin Manager (TPM)
set-environment -g TMUX_PLUGIN_MANAGER_PATH '~/.local/share/tmux/plugins'
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'catppuccin/tmux'
set -g @plugin 'Morantron/tmux-fingers'
set -g @plugin 'aserowy/tmux.nvim'

# Plugin-specific settings
## Catppuccin theme
set -g @catppuccin_flavour 'latte'        # options: frappe, macchiato, mocha
set -g @catppuccin_window_default_text "#W"
set -g @catppuccin_window_current_text "#W"

## Neovim navigation & splits (aserowy/tmux.nvim)
set -g @tmux-nvim-navigation true
set -g @tmux-nvim-navigation-cycle true
set -g @tmux-nvim-navigation-keybinding-left  'C-h'
set -g @tmux-nvim-navigation-keybinding-down  'C-j'
set -g @tmux-nvim-navigation-keybinding-up    'C-k'
set -g @tmux-nvim-navigation-keybinding-right 'C-l'

set -g @tmux-nvim-resize true
set -g @tmux-nvim-resize-step-x 1
set -g @tmux-nvim-resize-step-y 1
set -g @tmux-nvim-resize-keybinding-left  'C-Left'
set -g @tmux-nvim-resize-keybinding-down  'C-Down'
set -g @tmux-nvim-resize-keybinding-up    'C-Up'
set -g @tmux-nvim-resize-keybinding-right 'C-Right'

set -g @tmux-nvim-swap true
set -g @tmux-nvim-swap-cycle false
set -g @tmux-nvim-swap-keybinding-left  'C-M-h'
set -g @tmux-nvim-swap-keybinding-down  'C-M-j'
set -g @tmux-nvim-swap-keybinding-up    'C-M-k'
set -g @tmux-nvim-swap-keybinding-right 'C-M-l'

# other mappings
# Move window RIGHT with wrapping (prefix+k)
bind-key k run-shell '
  idx=$(tmux display -p "#I");
  last=$(tmux list-windows | tail -1 | cut -d: -f1);
  if [ "$idx" -eq "$last" ]; then
    tmux swap-window -t 0;
    tmux select-window -t 0;
    tmux display-message "Wrapped to window 0.";
  else
    tmux swap-window -t $((idx+1));
    tmux select-window -t $((idx+1));
  fi
'
# Move window LEFT with wrapping (prefix+j)
bind-key j run-shell '
  idx=$(tmux display -p "#I");
  last=$(tmux list-windows | tail -1 | cut -d: -f1);
  if [ "$idx" -eq 0 ]; then
    tmux swap-window -t $last;
    tmux select-window -t $last;
    tmux display-message "Wrapped to window $last.";
  else
    tmux swap-window -t $((idx-1));
    tmux select-window -t $((idx-1));
  fi
'
# General TMUX settings
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set-option -g allow-rename off
set-window-option -g automatic-rename off
set-option -sg escape-time 10        # recommended for nvim
set-option -g focus-events on        # recommended for nvim (autoread)
set -g default-terminal "${TERM}"

# Status bar formatting
set -g window-status-format        "#{s/0/‚Å∞/;s/1/¬π/;s/2/¬≤/;s/3/¬≥/;s/4/‚Å¥/;s/5/‚Åµ/;s/6/‚Å∂/;s/7/‚Å∑/;s/8/‚Å∏/;s/9/‚Åπ/:window_index} #W#{?window_zoomed_flag, üîç,‚Åï}"
set -g window-status-current-format "#[bold,fg=colour13]#{s/0/‚Å∞/;s/1/¬π/;s/2/¬≤/;s/3/¬≥/;s/4/‚Å¥/;s/5/‚Åµ/;s/6/‚Å∂/;s/7/‚Å∑/;s/8/‚Å∏/;s/9/‚Åπ/:window_index} #W#{?window_zoomed_flag, üîç,‚Åï}"
set -g window-status-separator " "
set -g status-left  ' #[bold,fg=colour9]<3 #[nobold,fg=colour10]#S | '
set -g status-right ' | #[bold]%H:%M - %d %b %Y '

# 24-bit true color support
set -ag terminal-overrides ",*:XT@:Tc"
set -ga terminal-overrides ",xterm-256color:Tc"

# vi mode keys for copy-mode
set-window-option -g mode-keys vi

# Enable mouse support
set -g mouse on

# Key bindings

## remap prefix from 'C-b' to 'C-a'
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

## Window & pane management
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind C new-window     -c "#{pane_current_path}"
bind -n 'M-a' last-window
bind -n 'M-1' select-window -t 1
bind -n 'M-2' select-window -t 2
bind -n 'M-3' select-window -t 3
bind -n 'M-4' select-window -t 4
bind -n 'M-5' select-window -t 5
bind -n 'M-6' select-window -t 6
bind -n 'M-7' select-window -t 7
bind -n 'M-8' select-window -t 8
bind -n 'M-9' select-window -t 9
bind -n 'M-0' select-window -t 0

## Reorder windows
bind -n S-Left  swap-window -d -t -1
bind -n S-Right swap-window -d -t +1

## Copy & paste (vim-style)
bind C-[ copy-mode
bind -T copy-mode-vi v                 send -X begin-selection
bind -T copy-mode-vi y                 send-keys -X copy-pipe-and-cancel
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel
bind P                                paste-buffer

## Scroll in copy-mode
bind-key -T copy-mode-vi C-u send-keys -X -N 5 scroll-up
bind-key -T copy-mode-vi C-d send-keys -X -N 5 scroll-down

## Misc
bind-key g    new-window -n "üêô" -c "#{pane_current_path}" "lazygit"
bind-key o    new-window -n "ü§ñ" -c "#{pane_current_path}" "opencode ."
bind C-l       send-keys 'C-l'                    # clear screen
bind R         run-shell 'tmux rename-window "$(basename "$(tmux display-message -p "#{pane_current_path}")")"' \; display-message "Renamed"
bind-key r     source-file "~/.config/tmux/tmux.conf" \; display-message "tmux.conf reloaded!"

## Sessions
# bind C-j display-popup -E "notify-send he"
bind C-j display-popup -E "$HOME/.local/bin/tmux-session-fzf"

# Initialize TPM (keep this at the very bottom)
run '~/.local/share/tmux/plugins/tpm/tpm'
